{"cells":[{"cell_type":"markdown","metadata":{"id":"YRGD3fdtp58Y"},"source":["**Author**: Kedi Yan\n","\n","**Date**: December 5th, 2022\n","\n","**Project**: EE 562 AI for Engineers Final Project"]},{"cell_type":"markdown","source":["# PREPERATION"],"metadata":{"id":"I3E25a1yu-8W"}},{"cell_type":"code","source":["''' ONLY RUN THIS ONCE '''\n","# %cd /content/gdrive/MyDrive/\"Colab Notebooks\"/\"UW EE562 AI for Engineers\"/HW6-FinalProject\n","# !git clone https://github.com/RAIVNLab/MRL.git"],"metadata":{"id":"5yDHkInK5MEA"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["''' MOUNT GOOGLE DRIVE '''\n","from google.colab import drive\n","drive.mount('/content/gdrive')"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"ul7lw3ja8Q3X","executionInfo":{"status":"ok","timestamp":1670707197667,"user_tz":480,"elapsed":9513,"user":{"displayName":"Kedi Yan","userId":"11951919201492688743"}},"outputId":"2692ad2c-8163-4c7e-d9ae-f7d4d6f6be6f"},"execution_count":2,"outputs":[{"output_type":"stream","name":"stdout","text":["Mounted at /content/gdrive\n"]}]},{"cell_type":"code","source":["''' INSTALL PACKAGES '''\n","!apt update && apt install -y --no-install-recommends libopencv-dev libturbojpeg-dev\n","!cp -f /usr/lib/x86_64-linux-gnu/pkgconfig/opencv.pc /usr/lib/x86_64-linux-gnu/pkgconfig/opencv4.pc\n","%cd /content/gdrive/MyDrive/\"Colab Notebooks\"/\"UW EE562 AI for Engineers\"/HW6-FinalProject/MRL/\n","!pip install -r requirements.txt\n","!pip install opencv_contrib_python\n","!pip install ffcv"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"Qa6AP0j2k2yj","executionInfo":{"status":"ok","timestamp":1670707255442,"user_tz":480,"elapsed":57779,"user":{"displayName":"Kedi Yan","userId":"11951919201492688743"}},"outputId":"e506d32a-baa6-4636-eb89-7402c497b26f"},"execution_count":3,"outputs":[{"output_type":"stream","name":"stdout","text":["Get:1 https://cloud.r-project.org/bin/linux/ubuntu bionic-cran40/ InRelease [3,626 B]\n","Hit:2 http://ppa.launchpad.net/c2d4u.team/c2d4u4.0+/ubuntu bionic InRelease\n","Ign:3 https://developer.download.nvidia.com/compute/machine-learning/repos/ubuntu1804/x86_64  InRelease\n","Get:4 https://developer.download.nvidia.com/compute/cuda/repos/ubuntu1804/x86_64  InRelease [1,581 B]\n","Hit:5 https://developer.download.nvidia.com/compute/machine-learning/repos/ubuntu1804/x86_64  Release\n","Get:6 http://security.ubuntu.com/ubuntu bionic-security InRelease [88.7 kB]\n","Get:7 https://developer.download.nvidia.com/compute/cuda/repos/ubuntu1804/x86_64  Packages [1,073 kB]\n","Hit:8 http://archive.ubuntu.com/ubuntu bionic InRelease\n","Hit:9 http://ppa.launchpad.net/cran/libgit2/ubuntu bionic InRelease\n","Get:11 http://archive.ubuntu.com/ubuntu bionic-updates InRelease [88.7 kB]\n","Hit:12 http://ppa.launchpad.net/deadsnakes/ppa/ubuntu bionic InRelease\n","Hit:13 http://ppa.launchpad.net/graphics-drivers/ppa/ubuntu bionic InRelease\n","Get:14 http://archive.ubuntu.com/ubuntu bionic-backports InRelease [83.3 kB]\n","Get:15 http://security.ubuntu.com/ubuntu bionic-security/main amd64 Packages [3,099 kB]\n","Get:16 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 Packages [3,524 kB]\n","Get:17 http://security.ubuntu.com/ubuntu bionic-security/universe amd64 Packages [1,567 kB]\n","Get:18 http://security.ubuntu.com/ubuntu bionic-security/restricted amd64 Packages [1,311 kB]\n","Get:19 http://archive.ubuntu.com/ubuntu bionic-updates/restricted amd64 Packages [1,352 kB]\n","Get:20 http://archive.ubuntu.com/ubuntu bionic-updates/universe amd64 Packages [2,342 kB]\n","Fetched 14.5 MB in 4s (3,577 kB/s)\n","Reading package lists... Done\n","Building dependency tree       \n","Reading state information... Done\n","34 packages can be upgraded. Run 'apt list --upgradable' to see them.\n","Reading package lists... Done\n","Building dependency tree       \n","Reading state information... Done\n","Note, selecting 'libturbojpeg0-dev' instead of 'libturbojpeg-dev'\n","libopencv-dev is already the newest version (3.2.0+dfsg-4ubuntu0.1).\n","The following package was automatically installed and is no longer required:\n","  libnvidia-common-460\n","Use 'apt autoremove' to remove it.\n","The following NEW packages will be installed:\n","  libturbojpeg0-dev\n","0 upgraded, 1 newly installed, 0 to remove and 34 not upgraded.\n","Need to get 153 kB of archives.\n","After this operation, 760 kB of additional disk space will be used.\n","Get:1 http://archive.ubuntu.com/ubuntu bionic-updates/universe amd64 libturbojpeg0-dev amd64 1.5.2-0ubuntu5.18.04.6 [153 kB]\n","Fetched 153 kB in 1s (119 kB/s)\n","Selecting previously unselected package libturbojpeg0-dev:amd64.\n","(Reading database ... 124013 files and directories currently installed.)\n","Preparing to unpack .../libturbojpeg0-dev_1.5.2-0ubuntu5.18.04.6_amd64.deb ...\n","Unpacking libturbojpeg0-dev:amd64 (1.5.2-0ubuntu5.18.04.6) ...\n","Setting up libturbojpeg0-dev:amd64 (1.5.2-0ubuntu5.18.04.6) ...\n","/content/gdrive/MyDrive/Colab Notebooks/UW EE562 AI for Engineers/HW6-FinalProject/MRL\n","Looking in indexes: https://pypi.org/simple, https://us-python.pkg.dev/colab-wheels/public/simple/\n","Collecting git+https://github.com/modestyachts/ImageNetV2_pytorch (from -r requirements.txt (line 13))\n","  Cloning https://github.com/modestyachts/ImageNetV2_pytorch to /tmp/pip-req-build-0sp5lscb\n","  Running command git clone -q https://github.com/modestyachts/ImageNetV2_pytorch /tmp/pip-req-build-0sp5lscb\n","Collecting terminaltables\n","  Downloading terminaltables-3.1.10-py2.py3-none-any.whl (15 kB)\n","Collecting pytorch_pfn_extras\n","  Downloading pytorch-pfn-extras-0.6.3.tar.gz (134 kB)\n","\u001b[K     |████████████████████████████████| 134 kB 24.6 MB/s \n","\u001b[?25h  Installing build dependencies ... \u001b[?25l\u001b[?25hdone\n","  Getting requirements to build wheel ... \u001b[?25l\u001b[?25hdone\n","    Preparing wheel metadata ... \u001b[?25l\u001b[?25hdone\n","Collecting fastargs\n","  Downloading fastargs-1.2.0.tar.gz (12 kB)\n","Requirement already satisfied: matplotlib in /usr/local/lib/python3.8/dist-packages (from -r requirements.txt (line 4)) (3.2.2)\n","Collecting sklearn\n","  Downloading sklearn-0.0.post1.tar.gz (3.6 kB)\n","Collecting imgcat\n","  Downloading imgcat-0.5.0.tar.gz (9.9 kB)\n","Requirement already satisfied: pandas in /usr/local/lib/python3.8/dist-packages (from -r requirements.txt (line 7)) (1.3.5)\n","Collecting assertpy\n","  Downloading assertpy-1.1.tar.gz (25 kB)\n","Requirement already satisfied: tqdm in /usr/local/lib/python3.8/dist-packages (from -r requirements.txt (line 9)) (4.64.1)\n","Requirement already satisfied: psutil in /usr/local/lib/python3.8/dist-packages (from -r requirements.txt (line 10)) (5.4.8)\n","Collecting webdataset\n","  Downloading webdataset-0.2.31-py3-none-any.whl (50 kB)\n","\u001b[K     |████████████████████████████████| 50 kB 8.1 MB/s \n","\u001b[?25hCollecting torchmetrics\n","  Downloading torchmetrics-0.11.0-py3-none-any.whl (512 kB)\n","\u001b[K     |████████████████████████████████| 512 kB 68.6 MB/s \n","\u001b[?25hCollecting grad-cam\n","  Downloading grad-cam-1.4.6.tar.gz (7.8 MB)\n","\u001b[K     |████████████████████████████████| 7.8 MB 28.2 MB/s \n","\u001b[?25h  Installing build dependencies ... \u001b[?25l\u001b[?25hdone\n","  Getting requirements to build wheel ... \u001b[?25l\u001b[?25hdone\n","    Preparing wheel metadata ... \u001b[?25l\u001b[?25hdone\n","Requirement already satisfied: scikit-image in /usr/local/lib/python3.8/dist-packages (from -r requirements.txt (line 15)) (0.18.3)\n","Requirement already satisfied: torch in /usr/local/lib/python3.8/dist-packages (from pytorch_pfn_extras->-r requirements.txt (line 2)) (1.13.0+cu116)\n","Requirement already satisfied: typing-extensions>=3.10 in /usr/local/lib/python3.8/dist-packages (from pytorch_pfn_extras->-r requirements.txt (line 2)) (4.4.0)\n","Requirement already satisfied: packaging in /usr/local/lib/python3.8/dist-packages (from pytorch_pfn_extras->-r requirements.txt (line 2)) (21.3)\n","Requirement already satisfied: numpy in /usr/local/lib/python3.8/dist-packages (from pytorch_pfn_extras->-r requirements.txt (line 2)) (1.21.6)\n","Requirement already satisfied: cycler>=0.10 in /usr/local/lib/python3.8/dist-packages (from matplotlib->-r requirements.txt (line 4)) (0.11.0)\n","Requirement already satisfied: python-dateutil>=2.1 in /usr/local/lib/python3.8/dist-packages (from matplotlib->-r requirements.txt (line 4)) (2.8.2)\n","Requirement already satisfied: pyparsing!=2.0.4,!=2.1.2,!=2.1.6,>=2.0.1 in /usr/local/lib/python3.8/dist-packages (from matplotlib->-r requirements.txt (line 4)) (3.0.9)\n","Requirement already satisfied: kiwisolver>=1.0.1 in /usr/local/lib/python3.8/dist-packages (from matplotlib->-r requirements.txt (line 4)) (1.4.4)\n","Requirement already satisfied: six>=1.5 in /usr/local/lib/python3.8/dist-packages (from python-dateutil>=2.1->matplotlib->-r requirements.txt (line 4)) (1.15.0)\n","Requirement already satisfied: pytz>=2017.3 in /usr/local/lib/python3.8/dist-packages (from pandas->-r requirements.txt (line 7)) (2022.6)\n","Collecting braceexpand\n","  Downloading braceexpand-0.1.7-py2.py3-none-any.whl (5.9 kB)\n","Requirement already satisfied: pyyaml in /usr/local/lib/python3.8/dist-packages (from webdataset->-r requirements.txt (line 11)) (6.0)\n","Requirement already satisfied: Pillow in /usr/local/lib/python3.8/dist-packages (from grad-cam->-r requirements.txt (line 14)) (7.1.2)\n","Collecting ttach\n","  Downloading ttach-0.0.3-py3-none-any.whl (9.8 kB)\n","Requirement already satisfied: torchvision>=0.8.2 in /usr/local/lib/python3.8/dist-packages (from grad-cam->-r requirements.txt (line 14)) (0.14.0+cu116)\n","Requirement already satisfied: opencv-python in /usr/local/lib/python3.8/dist-packages (from grad-cam->-r requirements.txt (line 14)) (4.6.0.66)\n","Requirement already satisfied: scikit-learn in /usr/local/lib/python3.8/dist-packages (from grad-cam->-r requirements.txt (line 14)) (1.0.2)\n","Requirement already satisfied: requests in /usr/local/lib/python3.8/dist-packages (from torchvision>=0.8.2->grad-cam->-r requirements.txt (line 14)) (2.23.0)\n","Requirement already satisfied: scipy>=1.0.1 in /usr/local/lib/python3.8/dist-packages (from scikit-image->-r requirements.txt (line 15)) (1.7.3)\n","Requirement already satisfied: tifffile>=2019.7.26 in /usr/local/lib/python3.8/dist-packages (from scikit-image->-r requirements.txt (line 15)) (2022.10.10)\n","Requirement already satisfied: networkx>=2.0 in /usr/local/lib/python3.8/dist-packages (from scikit-image->-r requirements.txt (line 15)) (2.8.8)\n","Requirement already satisfied: PyWavelets>=1.1.1 in /usr/local/lib/python3.8/dist-packages (from scikit-image->-r requirements.txt (line 15)) (1.4.1)\n","Requirement already satisfied: imageio>=2.3.0 in /usr/local/lib/python3.8/dist-packages (from scikit-image->-r requirements.txt (line 15)) (2.9.0)\n","Requirement already satisfied: urllib3!=1.25.0,!=1.25.1,<1.26,>=1.21.1 in /usr/local/lib/python3.8/dist-packages (from requests->torchvision>=0.8.2->grad-cam->-r requirements.txt (line 14)) (1.24.3)\n","Requirement already satisfied: chardet<4,>=3.0.2 in /usr/local/lib/python3.8/dist-packages (from requests->torchvision>=0.8.2->grad-cam->-r requirements.txt (line 14)) (3.0.4)\n","Requirement already satisfied: idna<3,>=2.5 in /usr/local/lib/python3.8/dist-packages (from requests->torchvision>=0.8.2->grad-cam->-r requirements.txt (line 14)) (2.10)\n","Requirement already satisfied: certifi>=2017.4.17 in /usr/local/lib/python3.8/dist-packages (from requests->torchvision>=0.8.2->grad-cam->-r requirements.txt (line 14)) (2022.9.24)\n","Requirement already satisfied: joblib>=0.11 in /usr/local/lib/python3.8/dist-packages (from scikit-learn->grad-cam->-r requirements.txt (line 14)) (1.2.0)\n","Requirement already satisfied: threadpoolctl>=2.0.0 in /usr/local/lib/python3.8/dist-packages (from scikit-learn->grad-cam->-r requirements.txt (line 14)) (3.1.0)\n","Building wheels for collected packages: imagenetv2-pytorch, pytorch-pfn-extras, fastargs, sklearn, imgcat, assertpy, grad-cam\n","  Building wheel for imagenetv2-pytorch (setup.py) ... \u001b[?25l\u001b[?25hdone\n","  Created wheel for imagenetv2-pytorch: filename=imagenetv2_pytorch-0.1-py3-none-any.whl size=2663 sha256=ad88f3a3b4ffcc0eb4c24469d7a7f1ca822b5c5b184a072a05facc3dc21e2237\n","  Stored in directory: /tmp/pip-ephem-wheel-cache-egdcz7q8/wheels/d5/82/ba/3b57cbbde585844e0854ae7a960adefa366626c66bd3cedb81\n","  Building wheel for pytorch-pfn-extras (PEP 517) ... \u001b[?25l\u001b[?25hdone\n","  Created wheel for pytorch-pfn-extras: filename=pytorch_pfn_extras-0.6.3-py3-none-any.whl size=182861 sha256=3af69ff261b1799a732fbc50d37c68114b2b63d213be85c0bb58016fe8ec63ac\n","  Stored in directory: /root/.cache/pip/wheels/65/b1/e3/cd41c02e5f9b5506c1faa2652f47421d8aae1253bf17aa370b\n","  Building wheel for fastargs (setup.py) ... \u001b[?25l\u001b[?25hdone\n","  Created wheel for fastargs: filename=fastargs-1.2.0-py3-none-any.whl size=10926 sha256=fa37c9ed0eab00d7a47ebd153d36d02b1c4e717f1db67dd34edd2ab3668241d0\n","  Stored in directory: /root/.cache/pip/wheels/5f/05/09/44e0430a8e6413590ad62fb73e44c283b835f8ee3e2eb8c473\n","  Building wheel for sklearn (setup.py) ... \u001b[?25l\u001b[?25hdone\n","  Created wheel for sklearn: filename=sklearn-0.0.post1-py3-none-any.whl size=2344 sha256=fa95c266753df2e2a4339899d39dcfb6c7508cf67b2885e09a519b379cf7c0eb\n","  Stored in directory: /root/.cache/pip/wheels/14/25/f7/1cc0956978ae479e75140219088deb7a36f60459df242b1a72\n","  Building wheel for imgcat (setup.py) ... \u001b[?25l\u001b[?25hdone\n","  Created wheel for imgcat: filename=imgcat-0.5.0-py3-none-any.whl size=10507 sha256=ab1c200d18194b705d1733a7f09598f7bb4cbe46ad09c015cfbf00a93e15323c\n","  Stored in directory: /root/.cache/pip/wheels/44/71/4d/36f3fa465ff90f43b1e27aabdfb7fc08833efcce90de49ed4c\n","  Building wheel for assertpy (setup.py) ... \u001b[?25l\u001b[?25hdone\n","  Created wheel for assertpy: filename=assertpy-1.1-py3-none-any.whl size=42917 sha256=ab490da9c48b61ba866d09671becea8ceef6ed29c7321f2a3a3c32cd194a353f\n","  Stored in directory: /root/.cache/pip/wheels/57/86/c9/1310be6ddfb540daa0bf1ac204526837aa0a8b0e79f32855ff\n","  Building wheel for grad-cam (PEP 517) ... \u001b[?25l\u001b[?25hdone\n","  Created wheel for grad-cam: filename=grad_cam-1.4.6-py3-none-any.whl size=38261 sha256=2586b2c4a61b9c0a36bfe0403dadb16aa03569f13ae128ffdef14954df6e7db2\n","  Stored in directory: /root/.cache/pip/wheels/53/02/43/1f75726b5c28459596067ad91e36951463c01273eef661f09f\n","Successfully built imagenetv2-pytorch pytorch-pfn-extras fastargs sklearn imgcat assertpy grad-cam\n","Installing collected packages: ttach, braceexpand, webdataset, torchmetrics, terminaltables, sklearn, pytorch-pfn-extras, imgcat, imagenetv2-pytorch, grad-cam, fastargs, assertpy\n","Successfully installed assertpy-1.1 braceexpand-0.1.7 fastargs-1.2.0 grad-cam-1.4.6 imagenetv2-pytorch-0.1 imgcat-0.5.0 pytorch-pfn-extras-0.6.3 sklearn-0.0.post1 terminaltables-3.1.10 torchmetrics-0.11.0 ttach-0.0.3 webdataset-0.2.31\n","Looking in indexes: https://pypi.org/simple, https://us-python.pkg.dev/colab-wheels/public/simple/\n","Requirement already satisfied: opencv_contrib_python in /usr/local/lib/python3.8/dist-packages (4.6.0.66)\n","Requirement already satisfied: numpy>=1.17.3 in /usr/local/lib/python3.8/dist-packages (from opencv_contrib_python) (1.21.6)\n","Looking in indexes: https://pypi.org/simple, https://us-python.pkg.dev/colab-wheels/public/simple/\n","Collecting ffcv\n","  Downloading ffcv-0.0.3.tar.gz (53 kB)\n","\u001b[K     |████████████████████████████████| 53 kB 1.4 MB/s \n","\u001b[?25hRequirement already satisfied: terminaltables in /usr/local/lib/python3.8/dist-packages (from ffcv) (3.1.10)\n","Requirement already satisfied: pytorch_pfn_extras in /usr/local/lib/python3.8/dist-packages (from ffcv) (0.6.3)\n","Requirement already satisfied: fastargs in /usr/local/lib/python3.8/dist-packages (from ffcv) (1.2.0)\n","Requirement already satisfied: matplotlib in /usr/local/lib/python3.8/dist-packages (from ffcv) (3.2.2)\n","Requirement already satisfied: sklearn in /usr/local/lib/python3.8/dist-packages (from ffcv) (0.0.post1)\n","Requirement already satisfied: imgcat in /usr/local/lib/python3.8/dist-packages (from ffcv) (0.5.0)\n","Requirement already satisfied: pandas in /usr/local/lib/python3.8/dist-packages (from ffcv) (1.3.5)\n","Requirement already satisfied: assertpy in /usr/local/lib/python3.8/dist-packages (from ffcv) (1.1)\n","Requirement already satisfied: tqdm in /usr/local/lib/python3.8/dist-packages (from ffcv) (4.64.1)\n","Requirement already satisfied: psutil in /usr/local/lib/python3.8/dist-packages (from ffcv) (5.4.8)\n","Requirement already satisfied: webdataset in /usr/local/lib/python3.8/dist-packages (from ffcv) (0.2.31)\n","Requirement already satisfied: numpy>=1.11 in /usr/local/lib/python3.8/dist-packages (from matplotlib->ffcv) (1.21.6)\n","Requirement already satisfied: kiwisolver>=1.0.1 in /usr/local/lib/python3.8/dist-packages (from matplotlib->ffcv) (1.4.4)\n","Requirement already satisfied: pyparsing!=2.0.4,!=2.1.2,!=2.1.6,>=2.0.1 in /usr/local/lib/python3.8/dist-packages (from matplotlib->ffcv) (3.0.9)\n","Requirement already satisfied: cycler>=0.10 in /usr/local/lib/python3.8/dist-packages (from matplotlib->ffcv) (0.11.0)\n","Requirement already satisfied: python-dateutil>=2.1 in /usr/local/lib/python3.8/dist-packages (from matplotlib->ffcv) (2.8.2)\n","Requirement already satisfied: six>=1.5 in /usr/local/lib/python3.8/dist-packages (from python-dateutil>=2.1->matplotlib->ffcv) (1.15.0)\n","Requirement already satisfied: pytz>=2017.3 in /usr/local/lib/python3.8/dist-packages (from pandas->ffcv) (2022.6)\n","Requirement already satisfied: torch in /usr/local/lib/python3.8/dist-packages (from pytorch_pfn_extras->ffcv) (1.13.0+cu116)\n","Requirement already satisfied: typing-extensions>=3.10 in /usr/local/lib/python3.8/dist-packages (from pytorch_pfn_extras->ffcv) (4.4.0)\n","Requirement already satisfied: packaging in /usr/local/lib/python3.8/dist-packages (from pytorch_pfn_extras->ffcv) (21.3)\n","Requirement already satisfied: pyyaml in /usr/local/lib/python3.8/dist-packages (from webdataset->ffcv) (6.0)\n","Requirement already satisfied: braceexpand in /usr/local/lib/python3.8/dist-packages (from webdataset->ffcv) (0.1.7)\n","Building wheels for collected packages: ffcv\n","  Building wheel for ffcv (setup.py) ... \u001b[?25l\u001b[?25hdone\n","  Created wheel for ffcv: filename=ffcv-0.0.3-cp38-cp38-linux_x86_64.whl size=222813 sha256=3ff708a27c2d7a5de1c5048832a170a6653eeb57fe0283c3746808711a7365a7\n","  Stored in directory: /root/.cache/pip/wheels/07/7e/1b/daae00515e2688a078e5b35091f88daf34ee99b22fa682a988\n","Successfully built ffcv\n","Installing collected packages: ffcv\n","Successfully installed ffcv-0.0.3\n"]}]},{"cell_type":"markdown","source":["# TRAINING"],"metadata":{"id":"jpqgmJXnvHDz"}},{"cell_type":"code","source":["%cd /content/gdrive/MyDrive/\"Colab Notebooks\"/\"UW EE562 AI for Engineers\"/HW6-FinalProject/MRL/train\n","''' WRITE TRAIN FFCV FILE '''\n","!python write_imagenet.py \\\n","        --cfg.dataset=cifar \\\n","        --cfg.split=train \\\n","        --cfg.data_dir=/content/gdrive/MyDrive/\"Colab Notebooks\"/\"UW EE562 AI for Engineers\"/HW6-FinalProject/MRL/inference/data/ \\\n","        --cfg.write_path=/content/gdrive/MyDrive/\"Colab Notebooks\"/\"UW EE562 AI for Engineers\"/HW6-FinalProject/MRL/inference/cifar_train_500_0.50_90.ffcv \\\n","        --cfg.max_resolution=500 \\\n","        --cfg.write_mode=proportion \\\n","        --cfg.compress_probability=0.5 \\\n","        --cfg.jpeg_quality=90\n","''' WRITE VAL FFCV FILE '''\n","!python write_imagenet.py \\\n","        --cfg.dataset=cifar \\\n","        --cfg.split=val \\\n","        --cfg.data_dir=/content/gdrive/MyDrive/\"Colab Notebooks\"/\"UW EE562 AI for Engineers\"/HW6-FinalProject/MRL/inference/data/ \\\n","        --cfg.write_path=/content/gdrive/MyDrive/\"Colab Notebooks\"/\"UW EE562 AI for Engineers\"/HW6-FinalProject/MRL/inference/cifar_val_500_0.50_90.ffcv \\\n","        --cfg.max_resolution=500 \\\n","        --cfg.write_mode=proportion \\\n","        --cfg.compress_probability=0.5 \\\n","        --cfg.jpeg_quality=90"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"YVO56kK3vDu9","executionInfo":{"status":"ok","timestamp":1670707303629,"user_tz":480,"elapsed":48197,"user":{"displayName":"Kedi Yan","userId":"11951919201492688743"}},"outputId":"a59fe166-4489-4fb6-cb11-9fcabb4cb8dc"},"execution_count":4,"outputs":[{"output_type":"stream","name":"stdout","text":["/content/gdrive/MyDrive/Colab Notebooks/UW EE562 AI for Engineers/HW6-FinalProject/MRL/train\n","\u001b(0l\u001b(B Arguments defined\u001b(0qqqqqqqqwqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqk\u001b(B\n","\u001b(0x\u001b(B Parameter                \u001b(0x\u001b(B Value                                                                                                                         \u001b(0x\u001b(B\n","\u001b(0tqqqqqqqqqqqqqqqqqqqqqqqqqqnqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqu\u001b(B\n","\u001b(0x\u001b(B cfg.dataset              \u001b(0x\u001b(B cifar                                                                                                                         \u001b(0x\u001b(B\n","\u001b(0x\u001b(B cfg.split                \u001b(0x\u001b(B train                                                                                                                         \u001b(0x\u001b(B\n","\u001b(0x\u001b(B cfg.data_dir             \u001b(0x\u001b(B /content/gdrive/MyDrive/Colab Notebooks/UW EE562 AI for Engineers/HW6-FinalProject/MRL/inference/data/                        \u001b(0x\u001b(B\n","\u001b(0x\u001b(B cfg.write_path           \u001b(0x\u001b(B /content/gdrive/MyDrive/Colab Notebooks/UW EE562 AI for Engineers/HW6-FinalProject/MRL/inference/cifar_train_500_0.50_90.ffcv \u001b(0x\u001b(B\n","\u001b(0x\u001b(B cfg.write_mode           \u001b(0x\u001b(B proportion                                                                                                                    \u001b(0x\u001b(B\n","\u001b(0x\u001b(B cfg.max_resolution       \u001b(0x\u001b(B 500                                                                                                                           \u001b(0x\u001b(B\n","\u001b(0x\u001b(B cfg.num_workers          \u001b(0x\u001b(B 16                                                                                                                            \u001b(0x\u001b(B\n","\u001b(0x\u001b(B cfg.chunk_size           \u001b(0x\u001b(B 100                                                                                                                           \u001b(0x\u001b(B\n","\u001b(0x\u001b(B cfg.jpeg_quality         \u001b(0x\u001b(B 90.0                                                                                                                          \u001b(0x\u001b(B\n","\u001b(0x\u001b(B cfg.subset               \u001b(0x\u001b(B -1                                                                                                                            \u001b(0x\u001b(B\n","\u001b(0x\u001b(B cfg.compress_probability \u001b(0x\u001b(B 0.5                                                                                                                           \u001b(0x\u001b(B\n","\u001b(0mqqqqqqqqqqqqqqqqqqqqqqqqqqvqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqj\u001b(B\n","Files already downloaded and verified\n","100% 50000/50000 [00:07<00:00, 6388.97it/s] \n","\u001b(0l\u001b(B Arguments defined\u001b(0qqqqqqqqwqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqk\u001b(B\n","\u001b(0x\u001b(B Parameter                \u001b(0x\u001b(B Value                                                                                                                       \u001b(0x\u001b(B\n","\u001b(0tqqqqqqqqqqqqqqqqqqqqqqqqqqnqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqu\u001b(B\n","\u001b(0x\u001b(B cfg.dataset              \u001b(0x\u001b(B cifar                                                                                                                       \u001b(0x\u001b(B\n","\u001b(0x\u001b(B cfg.split                \u001b(0x\u001b(B val                                                                                                                         \u001b(0x\u001b(B\n","\u001b(0x\u001b(B cfg.data_dir             \u001b(0x\u001b(B /content/gdrive/MyDrive/Colab Notebooks/UW EE562 AI for Engineers/HW6-FinalProject/MRL/inference/data/                      \u001b(0x\u001b(B\n","\u001b(0x\u001b(B cfg.write_path           \u001b(0x\u001b(B /content/gdrive/MyDrive/Colab Notebooks/UW EE562 AI for Engineers/HW6-FinalProject/MRL/inference/cifar_val_500_0.50_90.ffcv \u001b(0x\u001b(B\n","\u001b(0x\u001b(B cfg.write_mode           \u001b(0x\u001b(B proportion                                                                                                                  \u001b(0x\u001b(B\n","\u001b(0x\u001b(B cfg.max_resolution       \u001b(0x\u001b(B 500                                                                                                                         \u001b(0x\u001b(B\n","\u001b(0x\u001b(B cfg.num_workers          \u001b(0x\u001b(B 16                                                                                                                          \u001b(0x\u001b(B\n","\u001b(0x\u001b(B cfg.chunk_size           \u001b(0x\u001b(B 100                                                                                                                         \u001b(0x\u001b(B\n","\u001b(0x\u001b(B cfg.jpeg_quality         \u001b(0x\u001b(B 90.0                                                                                                                        \u001b(0x\u001b(B\n","\u001b(0x\u001b(B cfg.subset               \u001b(0x\u001b(B -1                                                                                                                          \u001b(0x\u001b(B\n","\u001b(0x\u001b(B cfg.compress_probability \u001b(0x\u001b(B 0.5                                                                                                                         \u001b(0x\u001b(B\n","\u001b(0mqqqqqqqqqqqqqqqqqqqqqqqqqqvqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqj\u001b(B\n","Files already downloaded and verified\n","100% 10000/10000 [00:04<00:00, 2375.96it/s] \n"]}]},{"cell_type":"code","source":["%cd /content/gdrive/MyDrive/\"Colab Notebooks\"/\"UW EE562 AI for Engineers\"/HW6-FinalProject/MRL/train\n","!export CUDA_VISIBLE_DEVICES=0,1\n","!python train_imagenet.py \\\n","  --config-file /content/gdrive/MyDrive/\"Colab Notebooks\"/\"UW EE562 AI for Engineers\"/HW6-FinalProject/MRL/train/rn50_configs/rn50_40_epochs.yaml \\\n","  --model.mrl=1 \\\n","  --data.train_dataset=/content/gdrive/MyDrive/\"Colab Notebooks\"/\"UW EE562 AI for Engineers\"/HW6-FinalProject/MRL/inference/cifar_train_500_0.50_90.ffcv \\\n","  --data.val_dataset=/content/gdrive/MyDrive/\"Colab Notebooks\"/\"UW EE562 AI for Engineers\"/HW6-FinalProject/MRL/inference/cifar_val_500_0.50_90.ffcv \\\n","  --data.num_workers=2 \\\n","  --data.in_memory=1 \\\n","  --dist.world_size=1 \\\n","  --training.distributed=0 \\\n","  --training.batch_size=16 \\\n","  --training.epochs=20 \\\n","  --validation.batch_size=16 \\\n","  --lr.lr=0.02 \\\n","  --logging.folder=/content/gdrive/MyDrive/\"Colab Notebooks\"/\"UW EE562 AI for Engineers\"/HW6-FinalProject/MRL/train/trainlogs \\\n","  --logging.log_level=1"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"5JL3Ejikq_Wx","outputId":"12238371-572c-49ba-d714-20e86cc40c41","executionInfo":{"status":"ok","timestamp":1670711453173,"user_tz":480,"elapsed":4149553,"user":{"displayName":"Kedi Yan","userId":"11951919201492688743"}}},"execution_count":5,"outputs":[{"output_type":"stream","name":"stdout","text":["/content/gdrive/MyDrive/Colab Notebooks/UW EE562 AI for Engineers/HW6-FinalProject/MRL/train\n","\u001b(0l\u001b(B Arguments defined\u001b(0qqqqqqqqwqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqk\u001b(B\n","\u001b(0x\u001b(B Parameter                \u001b(0x\u001b(B Value                                                                                                                         \u001b(0x\u001b(B\n","\u001b(0tqqqqqqqqqqqqqqqqqqqqqqqqqqnqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqu\u001b(B\n","\u001b(0x\u001b(B model.arch               \u001b(0x\u001b(B resnet50                                                                                                                      \u001b(0x\u001b(B\n","\u001b(0x\u001b(B model.pretrained         \u001b(0x\u001b(B 0                                                                                                                             \u001b(0x\u001b(B\n","\u001b(0x\u001b(B model.efficient          \u001b(0x\u001b(B 0                                                                                                                             \u001b(0x\u001b(B\n","\u001b(0x\u001b(B model.mrl                \u001b(0x\u001b(B 1                                                                                                                             \u001b(0x\u001b(B\n","\u001b(0x\u001b(B model.nesting_start      \u001b(0x\u001b(B 3                                                                                                                             \u001b(0x\u001b(B\n","\u001b(0x\u001b(B model.fixed_feature      \u001b(0x\u001b(B 2048                                                                                                                          \u001b(0x\u001b(B\n","\u001b(0x\u001b(B resolution.min_res       \u001b(0x\u001b(B 160                                                                                                                           \u001b(0x\u001b(B\n","\u001b(0x\u001b(B resolution.max_res       \u001b(0x\u001b(B 192                                                                                                                           \u001b(0x\u001b(B\n","\u001b(0x\u001b(B resolution.end_ramp      \u001b(0x\u001b(B 34                                                                                                                            \u001b(0x\u001b(B\n","\u001b(0x\u001b(B resolution.start_ramp    \u001b(0x\u001b(B 29                                                                                                                            \u001b(0x\u001b(B\n","\u001b(0x\u001b(B data.train_dataset       \u001b(0x\u001b(B /content/gdrive/MyDrive/Colab Notebooks/UW EE562 AI for Engineers/HW6-FinalProject/MRL/inference/cifar_train_500_0.50_90.ffcv \u001b(0x\u001b(B\n","\u001b(0x\u001b(B data.val_dataset         \u001b(0x\u001b(B /content/gdrive/MyDrive/Colab Notebooks/UW EE562 AI for Engineers/HW6-FinalProject/MRL/inference/cifar_val_500_0.50_90.ffcv   \u001b(0x\u001b(B\n","\u001b(0x\u001b(B data.num_workers         \u001b(0x\u001b(B 2                                                                                                                             \u001b(0x\u001b(B\n","\u001b(0x\u001b(B data.in_memory           \u001b(0x\u001b(B 1                                                                                                                             \u001b(0x\u001b(B\n","\u001b(0x\u001b(B lr.step_ratio            \u001b(0x\u001b(B 0.1                                                                                                                           \u001b(0x\u001b(B\n","\u001b(0x\u001b(B lr.step_length           \u001b(0x\u001b(B 30                                                                                                                            \u001b(0x\u001b(B\n","\u001b(0x\u001b(B lr.lr_schedule_type      \u001b(0x\u001b(B cyclic                                                                                                                        \u001b(0x\u001b(B\n","\u001b(0x\u001b(B lr.lr                    \u001b(0x\u001b(B 0.02                                                                                                                          \u001b(0x\u001b(B\n","\u001b(0x\u001b(B lr.lr_peak_epoch         \u001b(0x\u001b(B 2                                                                                                                             \u001b(0x\u001b(B\n","\u001b(0x\u001b(B logging.folder           \u001b(0x\u001b(B /content/gdrive/MyDrive/Colab Notebooks/UW EE562 AI for Engineers/HW6-FinalProject/MRL/train/trainlogs                        \u001b(0x\u001b(B\n","\u001b(0x\u001b(B logging.log_level        \u001b(0x\u001b(B 1                                                                                                                             \u001b(0x\u001b(B\n","\u001b(0x\u001b(B validation.batch_size    \u001b(0x\u001b(B 16                                                                                                                            \u001b(0x\u001b(B\n","\u001b(0x\u001b(B validation.resolution    \u001b(0x\u001b(B 256                                                                                                                           \u001b(0x\u001b(B\n","\u001b(0x\u001b(B validation.lr_tta        \u001b(0x\u001b(B 1                                                                                                                             \u001b(0x\u001b(B\n","\u001b(0x\u001b(B training.eval_only       \u001b(0x\u001b(B 0                                                                                                                             \u001b(0x\u001b(B\n","\u001b(0x\u001b(B training.batch_size      \u001b(0x\u001b(B 16                                                                                                                            \u001b(0x\u001b(B\n","\u001b(0x\u001b(B training.optimizer       \u001b(0x\u001b(B sgd                                                                                                                           \u001b(0x\u001b(B\n","\u001b(0x\u001b(B training.momentum        \u001b(0x\u001b(B 0.9                                                                                                                           \u001b(0x\u001b(B\n","\u001b(0x\u001b(B training.weight_decay    \u001b(0x\u001b(B 0.0001                                                                                                                        \u001b(0x\u001b(B\n","\u001b(0x\u001b(B training.epochs          \u001b(0x\u001b(B 20                                                                                                                            \u001b(0x\u001b(B\n","\u001b(0x\u001b(B training.label_smoothing \u001b(0x\u001b(B 0.1                                                                                                                           \u001b(0x\u001b(B\n","\u001b(0x\u001b(B training.distributed     \u001b(0x\u001b(B 0                                                                                                                             \u001b(0x\u001b(B\n","\u001b(0x\u001b(B training.use_blurpool    \u001b(0x\u001b(B 1                                                                                                                             \u001b(0x\u001b(B\n","\u001b(0x\u001b(B dist.world_size          \u001b(0x\u001b(B 1                                                                                                                             \u001b(0x\u001b(B\n","\u001b(0x\u001b(B dist.address             \u001b(0x\u001b(B localhost                                                                                                                     \u001b(0x\u001b(B\n","\u001b(0x\u001b(B dist.port                \u001b(0x\u001b(B 12355                                                                                                                         \u001b(0x\u001b(B\n","\u001b(0mqqqqqqqqqqqqqqqqqqqqqqqqqqvqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqj\u001b(B\n","/usr/local/lib/python3.8/dist-packages/torchvision/models/_utils.py:208: UserWarning: The parameter 'pretrained' is deprecated since 0.13 and may be removed in the future, please use 'weights' instead.\n","  warnings.warn(\n","/usr/local/lib/python3.8/dist-packages/torchvision/models/_utils.py:223: UserWarning: Arguments other than a weight enum or `None` for 'weights' are deprecated since 0.13 and may be removed in the future. The current behavior is equivalent to passing `weights=None`.\n","  warnings.warn(msg)\n","Creating classification layer of type :\t MRL\n","=> Logging in /content/gdrive/MyDrive/Colab Notebooks/UW EE562 AI for Engineers/HW6-FinalProject/MRL/train/trainlogs/be55fffd-214c-4e55-8687-341e70d3f4d6\n","ep=0, iter=3124, shape=(16, 3, 160, 160), lrs=['0.010', '0.010']: 100% 3125/3125 [03:02<00:00, 17.09it/s]\n","100% 625/625 [00:43<00:00, 14.35it/s]\n","=> Log: {'current_lr': 0.009997800320000002, 'val_time': 43.576120138168335, 'top_1_8': 0.05909999832510948, 'top_1_16': 0.07090000063180923, 'top_1_32': 0.0803999975323677, 'top_1_64': 0.08540000021457672, 'top_1_128': 0.08429999649524689, 'top_1_256': 0.08579999953508377, 'top_1_512': 0.08269999921321869, 'top_1_1024': 0.08079999685287476, 'top_1_2048': 0.06949999928474426, 'top_5_8': 0.2362000048160553, 'top_5_16': 0.2662999927997589, 'top_5_32': 0.272599995136261, 'top_5_64': 0.2797999978065491, 'top_5_128': 0.27889999747276306, 'top_5_256': 0.2802000045776367, 'top_5_512': 0.2802000045776367, 'top_5_1024': 0.2775999903678894, 'top_5_2048': 0.25699999928474426, 'train_loss': 39.538230895996094, 'epoch': 0}\n","ep=1, iter=3124, shape=(16, 3, 160, 160), lrs=['0.020', '0.020']: 100% 3125/3125 [02:46<00:00, 18.81it/s]\n","100% 625/625 [00:41<00:00, 14.97it/s]\n","=> Log: {'current_lr': 0.01999680032, 'val_time': 41.74965190887451, 'top_1_8': 0.07989999651908875, 'top_1_16': 0.09809999912977219, 'top_1_32': 0.10509999841451645, 'top_1_64': 0.11670000106096268, 'top_1_128': 0.1193000003695488, 'top_1_256': 0.1225999966263771, 'top_1_512': 0.1256999969482422, 'top_1_1024': 0.1242000013589859, 'top_1_2048': 0.12309999763965607, 'top_5_8': 0.289900004863739, 'top_5_16': 0.31529998779296875, 'top_5_32': 0.32820001244544983, 'top_5_64': 0.34700000286102295, 'top_5_128': 0.34929999709129333, 'top_5_256': 0.3474000096321106, 'top_5_512': 0.3467000126838684, 'top_5_1024': 0.34130001068115234, 'top_5_2048': 0.33500000834465027, 'train_loss': 37.064453125, 'epoch': 1}\n","ep=2, iter=3124, shape=(16, 3, 160, 160), lrs=['0.019', '0.019']: 100% 3125/3125 [02:42<00:00, 19.24it/s]\n","100% 625/625 [00:41<00:00, 15.04it/s]\n","=> Log: {'current_lr': 0.018889244444444446, 'val_time': 41.56570553779602, 'top_1_8': 0.11760000139474869, 'top_1_16': 0.16869999468326569, 'top_1_32': 0.18050000071525574, 'top_1_64': 0.1882999986410141, 'top_1_128': 0.19099999964237213, 'top_1_256': 0.19619999825954437, 'top_1_512': 0.20090000331401825, 'top_1_1024': 0.20250000059604645, 'top_1_2048': 0.2011999934911728, 'top_5_8': 0.36640000343322754, 'top_5_16': 0.4350000023841858, 'top_5_32': 0.4616999924182892, 'top_5_64': 0.47110000252723694, 'top_5_128': 0.4763999879360199, 'top_5_256': 0.48339998722076416, 'top_5_512': 0.4869999885559082, 'top_5_1024': 0.49230000376701355, 'top_5_2048': 0.4846000075340271, 'train_loss': 34.99576950073242, 'epoch': 2}\n","ep=3, iter=3124, shape=(16, 3, 160, 160), lrs=['0.018', '0.018']: 100% 3125/3125 [02:41<00:00, 19.32it/s]\n","100% 625/625 [00:41<00:00, 15.03it/s]\n","=> Log: {'current_lr': 0.017778133333333335, 'val_time': 41.597843408584595, 'top_1_8': 0.15880000591278076, 'top_1_16': 0.20409999787807465, 'top_1_32': 0.22849999368190765, 'top_1_64': 0.2551000118255615, 'top_1_128': 0.26260000467300415, 'top_1_256': 0.26750001311302185, 'top_1_512': 0.271699994802475, 'top_1_1024': 0.27239999175071716, 'top_1_2048': 0.27160000801086426, 'top_5_8': 0.4406999945640564, 'top_5_16': 0.5034999847412109, 'top_5_32': 0.5414000153541565, 'top_5_64': 0.5685999989509583, 'top_5_128': 0.5742999911308289, 'top_5_256': 0.5787000060081482, 'top_5_512': 0.5796999931335449, 'top_5_1024': 0.5813999772071838, 'top_5_2048': 0.5763999819755554, 'train_loss': 32.94761657714844, 'epoch': 3}\n","ep=4, iter=3124, shape=(16, 3, 160, 160), lrs=['0.017', '0.017']: 100% 3125/3125 [02:42<00:00, 19.26it/s]\n","100% 625/625 [00:41<00:00, 15.01it/s]\n","=> Log: {'current_lr': 0.016667022222222223, 'val_time': 41.63947248458862, 'top_1_8': 0.16369999945163727, 'top_1_16': 0.2093999981880188, 'top_1_32': 0.24300000071525574, 'top_1_64': 0.27399998903274536, 'top_1_128': 0.28290000557899475, 'top_1_256': 0.2904999852180481, 'top_1_512': 0.2987000048160553, 'top_1_1024': 0.30160000920295715, 'top_1_2048': 0.301800012588501, 'top_5_8': 0.4302999973297119, 'top_5_16': 0.49630001187324524, 'top_5_32': 0.5275999903678894, 'top_5_64': 0.5648000240325928, 'top_5_128': 0.57669997215271, 'top_5_256': 0.5874999761581421, 'top_5_512': 0.5918999910354614, 'top_5_1024': 0.5938000082969666, 'top_5_2048': 0.5932000279426575, 'train_loss': 31.2850341796875, 'epoch': 4}\n","ep=5, iter=3124, shape=(16, 3, 160, 160), lrs=['0.016', '0.016']: 100% 3125/3125 [02:42<00:00, 19.24it/s]\n","100% 625/625 [00:41<00:00, 14.94it/s]\n","=> Log: {'current_lr': 0.01555591111111111, 'val_time': 41.84039807319641, 'top_1_8': 0.19030000269412994, 'top_1_16': 0.257099986076355, 'top_1_32': 0.2987000048160553, 'top_1_64': 0.3249000012874603, 'top_1_128': 0.3452000021934509, 'top_1_256': 0.353300005197525, 'top_1_512': 0.3601999878883362, 'top_1_1024': 0.3677000105381012, 'top_1_2048': 0.36880001425743103, 'top_5_8': 0.5074999928474426, 'top_5_16': 0.588100016117096, 'top_5_32': 0.6245999932289124, 'top_5_64': 0.6574000120162964, 'top_5_128': 0.6647999882698059, 'top_5_256': 0.6747000217437744, 'top_5_512': 0.6797999739646912, 'top_5_1024': 0.6832000017166138, 'top_5_2048': 0.6805999875068665, 'train_loss': 30.048017501831055, 'epoch': 5}\n","ep=6, iter=3124, shape=(16, 3, 160, 160), lrs=['0.014', '0.014']: 100% 3125/3125 [02:43<00:00, 19.16it/s]\n","100% 625/625 [00:41<00:00, 14.95it/s]\n","=> Log: {'current_lr': 0.014444799999999999, 'val_time': 41.80203866958618, 'top_1_8': 0.24549999833106995, 'top_1_16': 0.3151000142097473, 'top_1_32': 0.36230000853538513, 'top_1_64': 0.390500009059906, 'top_1_128': 0.4041999876499176, 'top_1_256': 0.41609999537467957, 'top_1_512': 0.4187000095844269, 'top_1_1024': 0.4223000109195709, 'top_1_2048': 0.41999998688697815, 'top_5_8': 0.5741999745368958, 'top_5_16': 0.6449999809265137, 'top_5_32': 0.6851999759674072, 'top_5_64': 0.7156000137329102, 'top_5_128': 0.7285000085830688, 'top_5_256': 0.7368999719619751, 'top_5_512': 0.7386000156402588, 'top_5_1024': 0.7398999929428101, 'top_5_2048': 0.7350000143051147, 'train_loss': 28.84511947631836, 'epoch': 6}\n","ep=7, iter=3124, shape=(16, 3, 160, 160), lrs=['0.013', '0.013']: 100% 3125/3125 [02:42<00:00, 19.26it/s]\n","100% 625/625 [00:41<00:00, 15.01it/s]\n","=> Log: {'current_lr': 0.01333368888888889, 'val_time': 41.641942501068115, 'top_1_8': 0.26649999618530273, 'top_1_16': 0.34619998931884766, 'top_1_32': 0.3896999955177307, 'top_1_64': 0.42719998955726624, 'top_1_128': 0.4440000057220459, 'top_1_256': 0.4546000063419342, 'top_1_512': 0.4596000015735626, 'top_1_1024': 0.4648999869823456, 'top_1_2048': 0.46650001406669617, 'top_5_8': 0.6169999837875366, 'top_5_16': 0.6866999864578247, 'top_5_32': 0.7181000113487244, 'top_5_64': 0.7495999932289124, 'top_5_128': 0.7598999738693237, 'top_5_256': 0.7688000202178955, 'top_5_512': 0.7735999822616577, 'top_5_1024': 0.7754999995231628, 'top_5_2048': 0.7745000123977661, 'train_loss': 27.74149513244629, 'epoch': 7}\n","ep=8, iter=3124, shape=(16, 3, 160, 160), lrs=['0.012', '0.012']: 100% 3125/3125 [02:41<00:00, 19.30it/s]\n","100% 625/625 [00:41<00:00, 14.97it/s]\n","=> Log: {'current_lr': 0.012222577777777778, 'val_time': 41.76345944404602, 'top_1_8': 0.27489998936653137, 'top_1_16': 0.36890000104904175, 'top_1_32': 0.41100001335144043, 'top_1_64': 0.4512999951839447, 'top_1_128': 0.47189998626708984, 'top_1_256': 0.4828999936580658, 'top_1_512': 0.49079999327659607, 'top_1_1024': 0.4927999973297119, 'top_1_2048': 0.49050000309944153, 'top_5_8': 0.6331999897956848, 'top_5_16': 0.7021999955177307, 'top_5_32': 0.7365000247955322, 'top_5_64': 0.7669000029563904, 'top_5_128': 0.7803000211715698, 'top_5_256': 0.7885000109672546, 'top_5_512': 0.7939000129699707, 'top_5_1024': 0.7936000227928162, 'top_5_2048': 0.7904999852180481, 'train_loss': 26.883625030517578, 'epoch': 8}\n","ep=9, iter=3124, shape=(16, 3, 160, 160), lrs=['0.011', '0.011']: 100% 3125/3125 [02:41<00:00, 19.38it/s]\n","100% 625/625 [00:41<00:00, 14.92it/s]\n","=> Log: {'current_lr': 0.011111466666666667, 'val_time': 41.905991315841675, 'top_1_8': 0.30790001153945923, 'top_1_16': 0.38670000433921814, 'top_1_32': 0.43369999527931213, 'top_1_64': 0.462799996137619, 'top_1_128': 0.48080000281333923, 'top_1_256': 0.4936000108718872, 'top_1_512': 0.4991999864578247, 'top_1_1024': 0.5023000240325928, 'top_1_2048': 0.4984000027179718, 'top_5_8': 0.6394000053405762, 'top_5_16': 0.7196000218391418, 'top_5_32': 0.7591000199317932, 'top_5_64': 0.779699981212616, 'top_5_128': 0.7943999767303467, 'top_5_256': 0.8027999997138977, 'top_5_512': 0.8036999702453613, 'top_5_1024': 0.8047000169754028, 'top_5_2048': 0.802299976348877, 'train_loss': 26.121139526367188, 'epoch': 9}\n","ep=10, iter=3124, shape=(16, 3, 160, 160), lrs=['0.010', '0.010']: 100% 3125/3125 [02:40<00:00, 19.44it/s]\n","100% 625/625 [00:41<00:00, 15.00it/s]\n","=> Log: {'current_lr': 0.010000355555555555, 'val_time': 41.68749809265137, 'top_1_8': 0.31850001215934753, 'top_1_16': 0.4165000021457672, 'top_1_32': 0.45509999990463257, 'top_1_64': 0.4871000051498413, 'top_1_128': 0.5074999928474426, 'top_1_256': 0.5169000029563904, 'top_1_512': 0.5230000019073486, 'top_1_1024': 0.5253999829292297, 'top_1_2048': 0.520799994468689, 'top_5_8': 0.6610999703407288, 'top_5_16': 0.7426000237464905, 'top_5_32': 0.7759000062942505, 'top_5_64': 0.7990000247955322, 'top_5_128': 0.8100000023841858, 'top_5_256': 0.8148999810218811, 'top_5_512': 0.8202999830245972, 'top_5_1024': 0.8198000192642212, 'top_5_2048': 0.8203999996185303, 'train_loss': 25.388513565063477, 'epoch': 10}\n","ep=11, iter=3124, shape=(16, 3, 160, 160), lrs=['0.009', '0.009']: 100% 3125/3125 [02:40<00:00, 19.44it/s]\n","100% 625/625 [00:41<00:00, 15.04it/s]\n","=> Log: {'current_lr': 0.008889244444444444, 'val_time': 41.573442459106445, 'top_1_8': 0.34700000286102295, 'top_1_16': 0.43459999561309814, 'top_1_32': 0.4763999879360199, 'top_1_64': 0.4977000057697296, 'top_1_128': 0.522599995136261, 'top_1_256': 0.5329999923706055, 'top_1_512': 0.5367000102996826, 'top_1_1024': 0.5394999980926514, 'top_1_2048': 0.5401999950408936, 'top_5_8': 0.6940000057220459, 'top_5_16': 0.7659000158309937, 'top_5_32': 0.7967000007629395, 'top_5_64': 0.8137999773025513, 'top_5_128': 0.8269000053405762, 'top_5_256': 0.8338000178337097, 'top_5_512': 0.836899995803833, 'top_5_1024': 0.8382999897003174, 'top_5_2048': 0.8374000191688538, 'train_loss': 24.759775161743164, 'epoch': 11}\n","ep=12, iter=3124, shape=(16, 3, 160, 160), lrs=['0.008', '0.008']: 100% 3125/3125 [02:40<00:00, 19.46it/s]\n","100% 625/625 [00:41<00:00, 14.97it/s]\n","=> Log: {'current_lr': 0.007778133333333333, 'val_time': 41.7563591003418, 'top_1_8': 0.36419999599456787, 'top_1_16': 0.4691999852657318, 'top_1_32': 0.5117999911308289, 'top_1_64': 0.5386999845504761, 'top_1_128': 0.5534999966621399, 'top_1_256': 0.5633000135421753, 'top_1_512': 0.5698000192642212, 'top_1_1024': 0.5730000138282776, 'top_1_2048': 0.5741999745368958, 'top_5_8': 0.7067000269889832, 'top_5_16': 0.7874000072479248, 'top_5_32': 0.8197000026702881, 'top_5_64': 0.8337000012397766, 'top_5_128': 0.8420000076293945, 'top_5_256': 0.8468000292778015, 'top_5_512': 0.8468999862670898, 'top_5_1024': 0.8514999747276306, 'top_5_2048': 0.8482999801635742, 'train_loss': 24.233915328979492, 'epoch': 12}\n","ep=13, iter=3124, shape=(16, 3, 160, 160), lrs=['0.007', '0.007']: 100% 3125/3125 [02:42<00:00, 19.21it/s]\n","100% 625/625 [00:41<00:00, 15.01it/s]\n","=> Log: {'current_lr': 0.006667022222222223, 'val_time': 41.6518132686615, 'top_1_8': 0.38190001249313354, 'top_1_16': 0.4733000099658966, 'top_1_32': 0.5134000182151794, 'top_1_64': 0.5421000123023987, 'top_1_128': 0.5573999881744385, 'top_1_256': 0.5687000155448914, 'top_1_512': 0.5738000273704529, 'top_1_1024': 0.5788999795913696, 'top_1_2048': 0.5784000158309937, 'top_5_8': 0.7200999855995178, 'top_5_16': 0.7896999716758728, 'top_5_32': 0.8240000009536743, 'top_5_64': 0.8353999853134155, 'top_5_128': 0.843999981880188, 'top_5_256': 0.8514999747276306, 'top_5_512': 0.8536999821662903, 'top_5_1024': 0.855400025844574, 'top_5_2048': 0.8551999926567078, 'train_loss': 23.648874282836914, 'epoch': 13}\n","ep=14, iter=3124, shape=(16, 3, 160, 160), lrs=['0.006', '0.006']: 100% 3125/3125 [02:40<00:00, 19.44it/s]\n","100% 625/625 [00:41<00:00, 15.12it/s]\n","=> Log: {'current_lr': 0.005555911111111112, 'val_time': 41.3397274017334, 'top_1_8': 0.3935999870300293, 'top_1_16': 0.48590001463890076, 'top_1_32': 0.5346999764442444, 'top_1_64': 0.5648999810218811, 'top_1_128': 0.5758000016212463, 'top_1_256': 0.5871000289916992, 'top_1_512': 0.5968999862670898, 'top_1_1024': 0.5999000072479248, 'top_1_2048': 0.5964999794960022, 'top_5_8': 0.732699990272522, 'top_5_16': 0.8051000237464905, 'top_5_32': 0.8348000049591064, 'top_5_64': 0.847599983215332, 'top_5_128': 0.8571000099182129, 'top_5_256': 0.8615000247955322, 'top_5_512': 0.8648999929428101, 'top_5_1024': 0.8669999837875366, 'top_5_2048': 0.8651000261306763, 'train_loss': 23.099143981933594, 'epoch': 14}\n","ep=15, iter=3124, shape=(16, 3, 160, 160), lrs=['0.004', '0.004']: 100% 3125/3125 [02:40<00:00, 19.53it/s]\n","100% 625/625 [00:41<00:00, 15.00it/s]\n","=> Log: {'current_lr': 0.0044448000000000005, 'val_time': 41.68562722206116, 'top_1_8': 0.4293000102043152, 'top_1_16': 0.5231999754905701, 'top_1_32': 0.5659999847412109, 'top_1_64': 0.5922999978065491, 'top_1_128': 0.6079000234603882, 'top_1_256': 0.6194000244140625, 'top_1_512': 0.6266000270843506, 'top_1_1024': 0.6288999915122986, 'top_1_2048': 0.6305000185966492, 'top_5_8': 0.7508000135421753, 'top_5_16': 0.8222000002861023, 'top_5_32': 0.8514000177383423, 'top_5_64': 0.8668000102043152, 'top_5_128': 0.871399998664856, 'top_5_256': 0.8776000142097473, 'top_5_512': 0.8784999847412109, 'top_5_1024': 0.8798999786376953, 'top_5_2048': 0.8787000179290771, 'train_loss': 22.48307228088379, 'epoch': 15}\n","ep=16, iter=3124, shape=(16, 3, 160, 160), lrs=['0.003', '0.003']: 100% 3125/3125 [02:40<00:00, 19.51it/s]\n","100% 625/625 [00:41<00:00, 15.03it/s]\n","=> Log: {'current_lr': 0.0033336888888888896, 'val_time': 41.592870235443115, 'top_1_8': 0.43479999899864197, 'top_1_16': 0.5358999967575073, 'top_1_32': 0.5820000171661377, 'top_1_64': 0.6029000282287598, 'top_1_128': 0.6154000163078308, 'top_1_256': 0.6266000270843506, 'top_1_512': 0.6280999779701233, 'top_1_1024': 0.6323999762535095, 'top_1_2048': 0.6330999732017517, 'top_5_8': 0.7559000253677368, 'top_5_16': 0.8263000249862671, 'top_5_32': 0.85589998960495, 'top_5_64': 0.8644999861717224, 'top_5_128': 0.870199978351593, 'top_5_256': 0.8743000030517578, 'top_5_512': 0.878600001335144, 'top_5_1024': 0.8809000253677368, 'top_5_2048': 0.882099986076355, 'train_loss': 21.888324737548828, 'epoch': 16}\n","ep=17, iter=3124, shape=(16, 3, 160, 160), lrs=['0.002', '0.002']: 100% 3125/3125 [02:40<00:00, 19.50it/s]\n","100% 625/625 [00:41<00:00, 15.05it/s]\n","=> Log: {'current_lr': 0.0022225777777777783, 'val_time': 41.526262044906616, 'top_1_8': 0.45320001244544983, 'top_1_16': 0.552299976348877, 'top_1_32': 0.6013000011444092, 'top_1_64': 0.6182000041007996, 'top_1_128': 0.6323000192642212, 'top_1_256': 0.64410001039505, 'top_1_512': 0.646399974822998, 'top_1_1024': 0.6492999792098999, 'top_1_2048': 0.6499999761581421, 'top_5_8': 0.7806000113487244, 'top_5_16': 0.8432999849319458, 'top_5_32': 0.8657000064849854, 'top_5_64': 0.8762000203132629, 'top_5_128': 0.8837000131607056, 'top_5_256': 0.8862000107765198, 'top_5_512': 0.8898000121116638, 'top_5_1024': 0.8895000219345093, 'top_5_2048': 0.8907999992370605, 'train_loss': 21.32309913635254, 'epoch': 17}\n","ep=18, iter=3124, shape=(16, 3, 160, 160), lrs=['0.001', '0.001']: 100% 3125/3125 [02:40<00:00, 19.53it/s]\n","100% 625/625 [00:41<00:00, 15.01it/s]\n","=> Log: {'current_lr': 0.001111466666666667, 'val_time': 41.64785885810852, 'top_1_8': 0.4717999994754791, 'top_1_16': 0.5795000195503235, 'top_1_32': 0.6223000288009644, 'top_1_64': 0.6394000053405762, 'top_1_128': 0.6516000032424927, 'top_1_256': 0.6581000089645386, 'top_1_512': 0.6640999913215637, 'top_1_1024': 0.6671000123023987, 'top_1_2048': 0.6693000197410583, 'top_5_8': 0.7832000255584717, 'top_5_16': 0.8522999882698059, 'top_5_32': 0.8783000111579895, 'top_5_64': 0.8912000060081482, 'top_5_128': 0.8952000141143799, 'top_5_256': 0.8985000252723694, 'top_5_512': 0.8999000191688538, 'top_5_1024': 0.9024999737739563, 'top_5_2048': 0.9045000076293945, 'train_loss': 20.686901092529297, 'epoch': 18}\n","ep=19, iter=3124, shape=(16, 3, 160, 160), lrs=['0.000', '0.000']: 100% 3125/3125 [02:41<00:00, 19.36it/s]\n","100% 625/625 [00:42<00:00, 14.84it/s]\n","=> Log: {'current_lr': 3.555555555556124e-07, 'val_time': 42.11112952232361, 'top_1_8': 0.48829999566078186, 'top_1_16': 0.5909000039100647, 'top_1_32': 0.6363999843597412, 'top_1_64': 0.6506999731063843, 'top_1_128': 0.6606000065803528, 'top_1_256': 0.6710000038146973, 'top_1_512': 0.6766999959945679, 'top_1_1024': 0.679099977016449, 'top_1_2048': 0.6811000108718872, 'top_5_8': 0.7965999841690063, 'top_5_16': 0.8600000143051147, 'top_5_32': 0.885699987411499, 'top_5_64': 0.8960000276565552, 'top_5_128': 0.8985000252723694, 'top_5_256': 0.9035999774932861, 'top_5_512': 0.9041000008583069, 'top_5_1024': 0.9057000279426575, 'top_5_2048': 0.9067999720573425, 'train_loss': 20.046720504760742, 'epoch': 19}\n","100% 625/625 [00:41<00:00, 14.91it/s]\n","=> Log: {'current_lr': 3.555555555556124e-07, 'val_time': 41.93205380439758, 'top_1_8': 0.48829999566078186, 'top_1_16': 0.5909000039100647, 'top_1_32': 0.6363999843597412, 'top_1_64': 0.6506999731063843, 'top_1_128': 0.6606000065803528, 'top_1_256': 0.6710000038146973, 'top_1_512': 0.6766999959945679, 'top_1_1024': 0.679099977016449, 'top_1_2048': 0.6811000108718872, 'top_5_8': 0.7965999841690063, 'top_5_16': 0.8600000143051147, 'top_5_32': 0.885699987411499, 'top_5_64': 0.8960000276565552, 'top_5_128': 0.8985000252723694, 'top_5_256': 0.9035999774932861, 'top_5_512': 0.9041000008583069, 'top_5_1024': 0.9057000279426575, 'top_5_2048': 0.9067999720573425, 'epoch': 19}\n"]}]},{"cell_type":"markdown","source":["# VALIDATION"],"metadata":{"id":"FoXUVuVyvEl9"}},{"cell_type":"code","source":["%cd /content/gdrive/MyDrive/\"Colab Notebooks\"/\"UW EE562 AI for Engineers\"/HW6-FinalProject/MRL/inference\n","!python pytorch_inference.py --path final_weights.pt --dataset CIFAR100 \\\n","  --tta --mrl --rep_size 1024"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"kTpi_QMg50Mg","executionInfo":{"status":"ok","timestamp":1670711556060,"user_tz":480,"elapsed":102930,"user":{"displayName":"Kedi Yan","userId":"11951919201492688743"}},"outputId":"d54cb1f5-0591-4a4c-eb88-be0e70938b31"},"execution_count":6,"outputs":[{"output_type":"stream","name":"stdout","text":["/content/gdrive/MyDrive/Colab Notebooks/UW EE562 AI for Engineers/HW6-FinalProject/MRL/inference\n","/usr/local/lib/python3.8/dist-packages/torchvision/models/_utils.py:135: UserWarning: Using 'weights' as positional parameter(s) is deprecated since 0.13 and may be removed in the future. Please use keyword parameter(s) instead.\n","  warnings.warn(\n","/usr/local/lib/python3.8/dist-packages/torchvision/models/_utils.py:223: UserWarning: Arguments other than a weight enum or `None` for 'weights' are deprecated since 0.13 and may be removed in the future. The current behavior is equivalent to passing `weights=None`.\n","  warnings.warn(msg)\n","Loading CIFAR-100 val set\n","Files already downloaded and verified\n","/usr/local/lib/python3.8/dist-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 12 worker processes in total. Our suggested max number of worker in current system is 2, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.\n","  warnings.warn(_create_warning_msg(\n","Batch: 100% 40/40 [01:18<00:00,  1.96s/it]\n","Evaluated 10000 images\n","Rep. Size \t 8 \n","\n","    Top-1 accuracy for 8 : 27.06\n","    Top-5 accuracy for 8 : 58.47\n","    Total time: 78.8  (average time per image: 7.88 ms)\n","Rep. Size \t 16 \n","\n","    Top-1 accuracy for 16 : 35.67\n","    Top-5 accuracy for 16 : 66.43\n","    Total time: 78.8  (average time per image: 7.88 ms)\n","Rep. Size \t 32 \n","\n","    Top-1 accuracy for 32 : 39.94\n","    Top-5 accuracy for 32 : 69.95\n","    Total time: 78.8  (average time per image: 7.88 ms)\n","Rep. Size \t 64 \n","\n","    Top-1 accuracy for 64 : 42.57\n","    Top-5 accuracy for 64 : 72.01\n","    Total time: 78.8  (average time per image: 7.88 ms)\n","Rep. Size \t 128 \n","\n","    Top-1 accuracy for 128 : 44.41\n","    Top-5 accuracy for 128 : 73.30\n","    Total time: 78.8  (average time per image: 7.88 ms)\n","Rep. Size \t 256 \n","\n","    Top-1 accuracy for 256 : 45.48\n","    Top-5 accuracy for 256 : 73.88\n","    Total time: 78.8  (average time per image: 7.88 ms)\n","Rep. Size \t 512 \n","\n","    Top-1 accuracy for 512 : 46.35\n","    Top-5 accuracy for 512 : 74.28\n","    Total time: 78.8  (average time per image: 7.88 ms)\n","Rep. Size \t 1024 \n","\n","    Top-1 accuracy for 1024 : 46.33\n","    Top-5 accuracy for 1024 : 74.70\n","    Total time: 78.8  (average time per image: 7.88 ms)\n","Rep. Size \t 2048 \n","\n","    Top-1 accuracy for 2048 : 47.10\n","    Top-5 accuracy for 2048 : 75.24\n","    Total time: 78.8  (average time per image: 7.88 ms)\n"]}]}],"metadata":{"colab":{"provenance":[],"mount_file_id":"1kF6YjhisL_Rct2yo4SGyFwmZuOEleOiX","authorship_tag":"ABX9TyPmQSt9JZGq/YRD+H+D29xw"},"kernelspec":{"display_name":"Python 3","name":"python3"},"language_info":{"name":"python"},"gpuClass":"standard","accelerator":"GPU"},"nbformat":4,"nbformat_minor":0}